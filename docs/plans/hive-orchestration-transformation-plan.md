# Hive Orchestration UI Pattern Adaptation Plan

## Overview

This plan outlines how to adapt the Hive Orchestrator to use the same UI components and patterns as the Hyatt orchestration, while maintaining its **moment-based** workflow (not campaign-based). The goal is to create visual consistency and better user experience by using SharedAgentCollaboration, SharedDeliverablePanel, and other shared components to show the 5-agent sequential workflow and image deliverables.

## Remaining Work Plan

### Phase 1: Fix Image Display Issues (CRITICAL)

#### 1.1 Fix ImageDeliverableCard to Display OpenAI Images

**Objective**: Ensure OpenAI-generated images display correctly in the UI

**Current Situation**:

- ImageDeliverableCard exists but may not properly display OpenAI base64 images
- Backend creates deliverables with `content: { promptText: baseResult.promptText, imageUrl: baseResult.imageUrl }`
- Need to verify image display works correctly

**End Goal**:

- OpenAI images display properly in ImageDeliverableCard
- Images show in deliverable modal when clicked
- Basic image functionality works

**Codex Prompt**:

```
Fix ImageDeliverableCard to properly display OpenAI-generated images.

Current file: frontend/src/components/shared/ImageDeliverableCard.tsx

REQUIREMENTS:
1. Fix image display logic
   - Check for deliverable.content.imageUrl (OpenAI base64 format)
   - Handle base64 images starting with "data:image/png;base64,"
   - Display images properly in the card

2. Add basic image download
   - Add download button for images
   - Generate filename from deliverable title
   - Handle base64 image download

3. Ensure proper image sizing
   - Responsive image display
   - Proper aspect ratio handling
   - Fallback for failed images

Current backend structure:
- deliverable.content.imageUrl contains OpenAI base64 image
- deliverable.type is set to 'image'
- Images are generated by Visual Prompt Generator agent
```

#### 1.2 Verify SharedDeliverablePanel Routes Images Correctly

**Objective**: Ensure image deliverables are routed to ImageDeliverableCard

**Current Situation**:

- Need to verify SharedDeliverablePanel correctly identifies and routes image deliverables
- Check if `isImageDeliverable()` function works properly

**End Goal**:

- Image deliverables show in ImageDeliverableCard
- Text deliverables show in SharedDeliverableCard
- Proper routing based on deliverable type

**Codex Prompt**:

```
Verify SharedDeliverablePanel correctly routes image deliverables.

Current file: frontend/src/components/shared/SharedDeliverablePanel.tsx

REQUIREMENTS:
1. Check isImageDeliverable function
   - Should detect deliverable.type === 'image'
   - Should detect deliverable.content.imageUrl
   - Should route to ImageDeliverableCard

2. Test with actual Hive workflow
   - Start Hive orchestration
   - Verify Visual Prompt deliverable shows as image
   - Check image displays correctly

3. Fix any routing issues
   - Ensure proper component selection
   - Handle edge cases
   - Maintain consistent styling
```

#### 1.3 Test Complete Image Workflow

**Objective**: Verify end-to-end image generation and display

**Current Situation**:

- Need to test complete workflow from OpenAI generation to display
- Verify images appear correctly in UI

**End Goal**:

- Complete workflow works: moment input → image generation → display
- Images show properly in both card and modal views

**Codex Prompt**:

```
Test complete Hive image workflow end-to-end.

Testing steps:
1. Start Hive orchestration with visual content request
2. Wait for Visual Prompt Generator to complete
3. Check if image appears in SharedDeliverablePanel
4. Click image to open modal
5. Test image download functionality

Expected behavior:
- Visual Prompt deliverable should show image preview
- Image should display in modal when clicked
- Download should work for base64 images
- No console errors related to image loading

If issues found:
- Check browser console for errors
- Verify imageUrl format in network tab
- Test with different image sizes
```

### Phase 2: Final Testing and Polish

#### 2.1 Test Complete Workflow Integration

**Objective**: Ensure all components work together

**Current Situation**:

- Individual components implemented, need integration testing
- Verify real-time updates work properly

**End Goal**:

- Complete workflow works smoothly
- Real-time progress updates function correctly

**Codex Prompt**:

```
Test complete Hive workflow integration.

Testing requirements:
1. Test complete workflow
   - Submit moment form
   - Watch real-time progress updates
   - Verify all 5 agents complete
   - Check deliverables appear correctly

2. Test image deliverables specifically
   - Visual Prompt should show image
   - Image should be downloadable
   - Modal should display image properly

3. Verify real-time updates
   - Progress indicators update
   - Phase transitions work
   - No polling errors

Expected workflow:
1. Trend Analysis (text)
2. Brand Lens (text)
3. Visual Prompt (image) ← Critical for testing
4. Modular Elements (text)
5. QA Review (text)
```

## Completed Work

### ✅ Phase 1: Backend Workflow Logic - COMPLETE

#### 1.1 Fix Agent Execution Order - ✅ **DONE**

- **✅ Correct agent order implemented**: Trend → Brand Lens → Visual Prompt → Modular Elements → QA Review
- **✅ Brand Lens agent added**: Properly imported and included in workflow
- **✅ Sequential execution**: Each agent builds on previous output
- **✅ UI state tracking**: Workflow state with phases and status updates

#### 1.2 Add UI State Management - ✅ **DONE**

- **✅ activeWorkflows Map**: Implemented for tracking running workflows
- **✅ Workflow state structure**: Complete with phases, status, deliverables, timestamps
- **✅ API endpoints**:
  - `GET /api/hive/workflows/:id` ✅
  - `GET /api/hive/workflows` ✅
  - `POST /api/hive-orchestrate` returns workflow ID ✅
- **✅ Phase tracking**: All 5 phases with status/timing

### ✅ Phase 2: Frontend Components - COMPLETE

#### 2.1 Improve HiveAgentCollaboration - ✅ **DONE**

- **✅ Real-time progress indicators**: Loading spinners for active phases
- **✅ Status messages**: Visual feedback for each phase
- **✅ Phase visualization**: Clear progression through 5 agents
- **✅ View Deliverable buttons**: For completed phases

#### 2.2 Add Progress Panel Integration - ✅ **DONE**

- **✅ SharedProgressPanel integrated**: Shows overall workflow progress
- **✅ Workflow status display**: Maps workflow to campaign interface
- **✅ Progress callback handling**: Opens side panel on view progress

#### 2.3 Enhance useHiveWorkflowState Hook - ✅ **DONE**

- **✅ Polling mechanism**: 2-second intervals for active workflows
- **✅ Real-time updates**: Automatic progress updates
- **✅ Error handling**: Graceful API error handling
- **✅ State management**: Complete workflow state transitions

### ✅ Phase 3: Type System - COMPLETE

#### 3.1 Update Deliverable Types - ✅ **DONE**

- **✅ Type field added**: `'text' | 'image' | 'mixed'` support
- **✅ HiveWorkflowState**: Proper phase status tracking
- **✅ Image content structure**: Proper typing for image deliverables

### ✅ Frontend Components Implemented

1. **HiveOrchestrationPage** - Uses SharedOrchestrationLayout like Hyatt ✅
2. **HiveMomentForm** - Moment-based input form (not campaign) ✅
3. **HiveAgentCollaboration** - Real-time 5-agent workflow visualization ✅
4. **ImageDeliverableCard** - Basic image deliverable handling ✅
5. **useHiveWorkflowState** - Hook for workflow state management ✅
6. **HiveWorkflowState type** - Added to types ✅
7. **SharedDeliverablePanel** - Updated to handle image deliverables ✅

### ✅ Backend Foundation

1. **Sequential API endpoint** - `/api/hive-orchestrate` with proper agent order ✅
2. **Agent classes** - All 5 agents with Brand Lens ✅
3. **Image generation** - Working image generation ✅
4. **Workflow state management** - Complete state tracking ✅
5. **Real-time updates** - Polling and progress tracking ✅

## Implementation Timeline

### Week 1: Fix Image Display

- Fix ImageDeliverableCard to display OpenAI images correctly
- Verify SharedDeliverablePanel routing
- Test complete image workflow

### Week 2: Final Testing

- Test complete workflow integration
- Fix any remaining issues
- Final polish

## Success Metrics

1. **Visual Consistency**: Hive uses same UI components as Hyatt ✅
2. **Workflow Visualization**: Clear 5-agent sequential workflow display ✅
3. **Image Support**: OpenAI images display and download correctly ⚠️ **NEEDS WORK**
4. **User Experience**: Smooth workflow from moment input to completion ✅
5. **Performance**: No degradation in system performance ✅

## Risk Mitigation

1. **Backward Compatibility**: Maintain existing Hive functionality ✅
2. **Testing Strategy**: Test image display functionality ⚠️ **IN PROGRESS**
3. **Rollback Plan**: Ability to revert changes if issues arise ✅
4. **User Training**: Documentation for new workflow visualization ✅

## Conclusion

The core Hive orchestration functionality is complete. The remaining work is focused on ensuring OpenAI-generated images display correctly in the UI. This is a straightforward fix to ensure the existing image generation works properly with the UI components.
